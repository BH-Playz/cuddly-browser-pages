(window.webpackJsonp=window.webpackJsonp||[]).push([[6,9,35],{106:function(e,t,i){"use strict";i.r(t),i.d(t,"iMessage",(function(){return p})),i.d(t,"message",(function(){return u}));var o=i(395),s=i(1),n=i(381),a=i(432),r=i.n(a),c=i(433),l=i.n(c),h=function(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};let p=class extends s.a{constructor(){super(...arguments),this.content="",this.type="error"}render(){const e={"infinity-message":!0,"position-top":"top"===this.type};return s.e`
      <div class=${Object(n.a)(e)}>
        ${this.renderImg()}
        <span>${this.content}</span>
      </div>
    `}renderImg(){return"error"===this.type?s.e`<img .src=${r.a} />`:"warn"===this.type?s.e`<img .src=${l.a} />`:void 0}};p.styles=s.b`
    :host {
      box-sizing: border-box;
      display: flex;
      position: fixed;
      min-width: 330px;
      padding: 0 20px;
      height: 60px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 1);
      box-shadow: 0px 6px 48px 0px rgba(0, 0, 0, 0.24);
      border-radius: 6px;
      z-index: 99999999999;
    }
    :host([type='top']) {
      width: 100%;
      margin: 0;
      left: 0;
      top: var(--top-bar-height);
      height: auto;
      padding: 5px;
      border-radius: 0;
      background: rgba(95, 92, 92, 0.6);
      color: #fff;
      transform: none;
      transition: all 300ms;
      opacity: 0;
      pointer-events: none;
    }
    :host(.anim[type='top']) {
      opacity: 1;
    }

    .infinity-message {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
    }
    img {
      width: 20px;
      height: 20px;
      margin-right: 8px;
    }
  `,h([Object(s.g)({type:String})],p.prototype,"content",void 0),h([Object(s.g)({type:String})],p.prototype,"type",void 0),p=h([Object(s.c)("i-message")],p);const u={newInstance:function(e,t=2,i,o){let s;if(document.querySelector("i-message"))return void clearInterval(s);const n=document.createElement("i-message");return n.setAttribute("content",e),n.setAttribute("type",i),document.body.appendChild(n),0!==t&&(s=setTimeout(()=>{document.body.removeChild(n),o&&o()},1e3*t)),n},error:function(e,t,i){o.default.error(e,t),i&&setTimeout(i,t)},success:function(e,t,i){o.default.success(e,t),i&&setTimeout(i,t)},top:function(e,t,i){const o=this.newInstance(e,t,"top",i);setTimeout(()=>null==o?void 0:o.classList.add("anim"))},warn:function(e,t,i){this.newInstance(e,t,"warn",i)}}},161:function(e,t,i){"use strict";i.r(t),i.d(t,"slave",(function(){return r}));i(7);var o=i(5),s=i.n(o),n=i(314),a=i(49);const r=new class{constructor(){if(this.channel=null,this.initResolve=[],this.initReject=[],this.messageScheduler=new n.a,this.initChannel=()=>{"serviceworker"===a.b?this.initServiceworker():"background"===a.b&&this.initBackground()},this.awaitChannel=()=>new s.a(async(e,t)=>{"serviceworker"===a.b?this.channel?(await this.channel.active,await this.channel.controlling,e(null)):(this.initResolve.push(e),this.initReject.push(t)):"background"===a.b&&e(null)}),this.initServiceworker=async()=>{try{const{createWorkBox:e}=await i.e(10).then(i.bind(null,602)),t=await e();if(!t)return;t.addEventListener("message",e=>{const{type:t,payload:i={}}=e.data;"master:bordcast-message"===t&&this.messageScheduler.execTask(i.type,i.payload)}),await t.active,await t.controlling,this.channel=t,this.initResolve.forEach(e=>{e()}),this.channel.postTask=this.channel.messageSW}catch(e){console.log("slave初始化错误：",e),this.initReject.forEach(e=>{e()})}},this.initBackground=()=>{this.channel={postTask:e=>new s.a((t,i)=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError&&i(chrome.runtime.lastError),t(e)})})},chrome.runtime.onMessage.addListener(({type:e,payload:t,ignoreId:i})=>{"master:bordcast-message"===e?chrome.tabs.getCurrent(e=>{i!==e.id&&this.messageScheduler.execTask(t.type,t.payload)}):"slave:bordcast-message"===e&&this.messageScheduler.execTask(t.data.type,t.data.payload)})},a.a)throw new Error("it's not page");this.initChannel()}postTask(e,t,i){return new s.a(async(o,s)=>{let n=!1;await this.awaitChannel();const r=Object.assign(Object.assign(Object.assign({},a.d),{taskId:Object(a.c)()}),i);r.timeout&&setTimeout(()=>{n||o({error:"timeout"})},r.timeout);try{const i=await this.channel.postTask({type:e,payload:Object.assign({data:t},r)});n=!0,o(i)}catch(e){o({error:e})}})}listenMessage(e,t){this.messageScheduler.listenTask(e,t)}sendMessage(e,t=""){this.postTask("slave:bordcast-message",{type:e,payload:t})}}},307:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));i(7);var o=i(2),s=i(161),n=function(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};const a={},r=new Set;class c{constructor(){this.firstSync=!1,this.syncTabTime=0,this._lockRollback=!1,this.isRollbackFromStorage=!1,this.backupFileKey="",this.backupValueKeys=[],this.rollbackFromStorage=()=>null,this.stopToStorageReaction=()=>{},this.stopAutoBackupReaction=()=>{},this.convertBackupEquals=e=>e}async initSyncStore(e,t,i={},n=20){const r=e.key;if(a[r])throw new Error("storage key 重复");a[r]=this,0!==t.length&&(this.rollbackFromStorage=async()=>{let s=!1;const a=Object.create(null);Object.keys(i).forEach(e=>{t.includes(e)&&(a[e]=i[e])});try{const{data:i,error:o}=await e.read();if(o)throw o;const n=i?Object.keys(i):[];i&&n.forEach(e=>{t.includes(e)&&(a[e]=i[e])}),this.firstSync||i&&!t.some(e=>!n.includes(e))||(s=!0)}catch(e){console.error("storageSync",e)}this.isRollbackFromStorage=!0,this.stopToStorageReaction(),this.stopAutoBackupReaction(),Object(o.i)(()=>{for(const e in a)this[e]=a[e];this.firstSync||(this.firstSync=!0)}),this.restartAutoBackupReaction(),this.stopToStorageReaction=Object(o.h)(()=>{const e={};return t.forEach(t=>{e[t]=Object(o.j)(this[t])}),e},t=>{this.isRollbackFromStorage=!1,e.create(t).then(()=>{Object(o.i)(()=>{this.syncTabTime=Date.now()})})},{equals:o.d.structural,delay:n,fireImmediately:s})},await this.rollbackFromStorage(),Object(o.h)(()=>this.syncTabTime,e=>{e&&s.slave.sendMessage("tabs-sync",r)},{delay:60}))}restartAutoBackupReaction(e=!1){this.stopAutoBackupReaction(),this.stopAutoBackupReaction=Object(o.h)(()=>{const e={};return this.backupValueKeys.forEach(t=>{e[t]=Object(o.j)(this[t])}),e},e=>{(async(e,t)=>{try{const{syncStore:o}=await Promise.all([i.e(8),i.e(7)]).then(i.bind(null,601));o.pushAutoBackupPipe({[e]:t})}catch(e){}})(this.backupFileKey,e).catch()},{fireImmediately:e,equals:(e,t)=>{const i=this.convertBackupEquals(e),s=this.convertBackupEquals(t);return o.d.structural(i,s)},delay:40})}initAutoBackup(e,t){if(r.has(e))throw new Error("file key 重复");r.add(e),0!==t.length&&(this.backupFileKey=e,this.backupValueKeys=[...t])}async getBackupData(){const e={};return this.backupValueKeys.forEach(t=>{e[t]=Object(o.j)(this[t])}),e}}n([o.g],c.prototype,"firstSync",void 0),n([o.g],c.prototype,"syncTabTime",void 0),n([o.b],c.prototype,"initSyncStore",null);const l=e=>{const t=a[e];(null==t?void 0:t._lockRollback)||t.rollbackFromStorage()}},309:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));i(7);var o=i(0),s=i(435),n=i(3);const a=Object(o.G)()?"pc":"mobile";var r=i(23);const c=new class{constructor(){this.ga=null,this.localKey="analytics-status-time",this.gap=432e5,this.getPermission=async()=>{let e=!0;if(o.n)try{const{privacyStore:t}=await Promise.all([i.e(8),i.e(7),i.e(40)]).then(i.bind(null,608));1!==t.collectData&&(e=!1)}catch(t){e=!1}return e},this.trySendStatus=e=>{const t=localStorage.getItem(this.localKey);t?(Date.now()-Number(t)>this.gap||Number(t)>Date.now())&&this.sendStatus(e):this.sendStatus(e)},this.sendPageView=async e=>{if(!await this.getPermission())return;const t=this.ga.getPageviewUrl(e);r.b.sendLog(t)},this.sendEvent=async(e,t=!1)=>{await this.getPermission()&&Object.keys(e).forEach(i=>{const o=e[i];if("object"==typeof o)Object.keys(o).forEach(e=>{const s=o[e],n=this.ga.getEventUrl({category:i,action:e,label:String(s),nonInteraction:t});r.b.sendLog(n)});else{const e=this.ga.getEventUrl({category:i,action:String(o),nonInteraction:t});r.b.sendLog(e)}})},this.sendBaidu=async e=>{await this.getPermission()&&(async(e="")=>{const t=o.C.runtimePlatform,i=a+"-"+t;if(null==e?void 0:e.includes("baidu.com")){const t=new URL(e).searchParams.get("tn"),s=`https://manage-api.infinitytab.com/analysis-manager/send/60efd763a741942ac60374e1?label=${o.B.baiduLabel}&action=${t}&event=${i}`;o.s?navigator.sendBeacon(s):n.a.post(s,null,{_proxy:!0})}})(e)},this.ga=new s.a({trackingId:o.B.trackingId})}async sendStatus(e){try{this.sendEvent(e,!0),localStorage.setItem(this.localKey,""+Date.now())}catch(e){}}}},314:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));class o{constructor(){this._events=new Map}listenTask(e,t){if("function"!=typeof t)return;this._events.has(e)||this._events.set(e,new Set);this._events.get(e).add(t)}execTask(e,t,...i){if(this._events.has(e)){const o=this._events.get(e);for(const e of o)e(t,...i)}}}},333:function(e,t,i){"use strict";var o;i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),function(e){e.openAiModal="master:openIframeAi",e.authToken="master:authToken",e.needLogin="slave:needLogin",e.openLogin="slave:openLogin",e.closeAiModal="slave:closeIframeAi",e.logout="master:logout"}(o||(o={}));const s=new class{constructor(){this.postIframeMessage=e=>{this.$chatai&&this.$chatai.contentWindow.postMessage(e,"*")},this.updateIframe=e=>{this.$chatai=e}}}},382:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));i(7);var o=i(2),s=i(403),n=i.n(s),a=i(307),r=i(15),c=i(13),l=i(161),h=function(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};const p=[{text:i18n("todo_welcome"),todoId:"todo-id1dtkk87it2iepal6dv4hr2uig0c",time:Date.now(),updatetime:0,done:!1}];class u extends a.a{constructor(){super(...arguments),this.todoList=p,this.currenetState="done",this.listLength=localStorage.getItem("todo-length")||0}toggleState(e){this.currenetState=e}get needNotificationPermission(){return this.todoList.some(e=>!!e.dueDate)}diffRemote(e){const t=e=>{if(null==e?void 0:e.updatetime){const t={updatetime:void 0};return e.done=!!e.done,Object.assign(Object.assign({},e),t)}},i=n()(e.todoList||[],t),s=n()(Object(o.j)(this.todoList),t);return!o.d.structural(i,s)}mergeRemote(e,t){if(e.todoList)if(t)this.todoList=e.todoList;else{const t=this.todoList,i=e.todoList,{result:o}=r.a.mergeArray(t,i,"todoId");this.todoList=o}}edit(e){this.todoList=this.todoList.map(t=>t.todoId===e?Object.assign(Object.assign({},t),{edit:!t.edit}):t)}get hasDoneTodo(){return this.todoList.filter(e=>e.done).length}async addTodo(e){if(!e.trim().length)return;const t={done:!1,time:+new Date,todoId:r.a.randomId("todo-"),updatetime:await r.a.getTimestamp(),text:e};Object(o.i)(()=>{this.todoList=[t,...this.todoList]})}removeTodo(){this.todoList=this.todoList.filter(e=>!e.done)}deleteTodo(e){this.todoList=this.todoList.filter(t=>t.todoId!==e)}async toggleTodo(e){const t=await r.a.getTimestamp();Object(o.i)(()=>{this.todoList=this.todoList.map(i=>i.todoId===e?Object.assign(Object.assign({},i),{done:!i.done,updatetime:t}):Object.assign({},i))})}async updateTodo(e,t){const i=await r.a.getTimestamp();Object(o.i)(()=>{this.todoList=this.todoList.map(o=>o.todoId===e?Object.assign(Object.assign(Object.assign({},o),t),{updatetime:i,edit:!1}):Object.assign({},o))})}removeTime(e){this.todoList=this.todoList.map(t=>t.todoId===e?Object.assign(Object.assign({},t),{dueDate:"",dueTime:"",dueTimestamp:null}):t)}}h([o.g],u.prototype,"todoList",void 0),h([o.g],u.prototype,"currenetState",void 0),h([o.b],u.prototype,"toggleState",null),h([o.e],u.prototype,"needNotificationPermission",null),h([o.b],u.prototype,"mergeRemote",null),h([o.b],u.prototype,"edit",null),h([o.g],u.prototype,"listLength",void 0),h([o.e],u.prototype,"hasDoneTodo",null),h([o.b],u.prototype,"addTodo",null),h([o.b],u.prototype,"removeTodo",null),h([o.b],u.prototype,"deleteTodo",null),h([o.b],u.prototype,"toggleTodo",null),h([o.b],u.prototype,"updateTodo",null),h([o.b],u.prototype,"removeTime",null);const d=new u;d.initSyncStore(c.k,["todoList","listLength"],{}),d.initAutoBackup("todo",["todoList"]),Object(o.c)(()=>{if(d.firstSync){const e=d.todoList.filter(e=>!e.done).length;Object(o.i)(()=>{d.listLength=e}),localStorage.setItem("todo-length",e+"")}});let g=!1;Object(o.c)(()=>{if(d.firstSync){const e=d.todoList.filter(e=>!e.done&&e.dueTimestamp>Date.now()).map(e=>Object(o.j)(e));if(!g)return void(g=!0);l.slave.postTask("slave:change-todo",e)}}),Object(o.c)(()=>{let e=!1;const{todoList:t}=d;for(let i=0;i<t.length-1;i++){const{done:o}=t[i],s=t[i+1].done;if(o&&!s){e=!0;break}}e&&(Object(o.i)(()=>{const e=t.filter(e=>e.done),i=t.filter(e=>!e.done);d.todoList=[...i,...e]}),e=!1)},{delay:300})},395:function(e,t,i){"use strict";i.r(t);var o=i(5),s=i.n(o),n=i(224),a=i(428),r=i(1),c=i(2),l=r.b`.i-bubble {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 99999999;
}
.i-bubble.network-error .i-bubble-wrap,
.i-bubble.error .i-bubble-wrap,
.i-bubble.success .i-bubble-wrap {
  padding-left: 30px;
  padding-right: 32px;
}
.i-bubble + .i-bubble-mask {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(255, 255, 255, 0.7);
  z-index: 999999;
  display: none;
  opacity: 0;
  transition: opacity 150ms ease-in 0s;
}
.i-bubble.loading + .i-bubble-mask {
  display: block;
}
.i-bubble.loading.popup + .i-bubble-mask {
  opacity: 1;
}
.i-bubble .i-bubble-wrap {
  margin: 0 auto;
  box-sizing: border-box;
  padding: 12px 20px;
  background-color: #333;
  box-shadow: 0px 2px 20px 0px rgba(0, 0, 0, 0.1);
  border-radius: 4px;
  display: flex;
  flex-flow: row nowrap;
  align-items: center;
  font-size: 14px;
  line-height: 1.4em;
  transition: opacity 0.15s cubic-bezier(0, 0, 0.2, 1) 0ms, transform 0.15s cubic-bezier(0, 0, 0.2, 1) 0ms;
  transform: scale(0.8);
  opacity: 0;
  box-shadow: 0 3px 5px -1px rgba(0, 0, 0, 0.2), 0 6px 10px 0 rgba(0, 0, 0, 0.14), 0 1px 18px 0 rgba(0, 0, 0, 0.12);
  max-width: 600px;
}
.i-bubble.popup .i-bubble-wrap {
  transform: scale(1);
  opacity: 1;
}
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
.i-bubble .icon {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  margin-right: 12px;
  display: none;
}
.i-bubble .icon.icon-loading {
  animation: spin 700ms linear infinite;
}
.i-bubble .i-bubble-text {
  color: #e4e4e4;
  display: block;
  box-sizing: border-box;
  flex-grow: 1;
  width: 100%;
  word-break: break-all;
}
.i-bubble .i-bubble-button {
  width: 70px;
  height: 28px;
  color: #4caf50;
  background-color: initial;
  border: none;
  padding: 0;
  cursor: pointer;
  transition: color, background-color 200ms;
  border-radius: 4px;
  outline: none;
  max-width: 180px;
  margin-left: 46px;
  flex-shrink: 0;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
.i-bubble .i-bubble-button:hover {
  background-color: rgba(76, 175, 80, 0.14);
}
`,h=i(15),p=i(51),u=function(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};const d=Object(p.a)("network-error.png",!1),g=Object(p.a)("error.png",!1),b=Object(p.a)("success.png",!1),m=Object(p.a)("loading.png",!1);class y extends n.a{constructor(){super(...arguments),this.popup=!1,this.showButton=!1}static _timeToHideHandler(e){if(e.showButton){const t=e.shadowRoot.querySelector(".i-bubble .i-bubble-button");t.onclick&&(t.onclick=null)}const t=e.shadowRoot.querySelector(".i-bubble > .i-bubble-wrap");let i=!1;const o=()=>{e.onmouseenter=null,e.onmouseleave=null,document.body.contains(e)&&document.body.removeChild(e),i=!0};t.addEventListener("transitionend",o,{once:!0}),t.addEventListener("transitioncancel",o,{once:!0}),setTimeout(()=>{i||o()},150),e.setPopup(!1)}static _setTimerToHide(e,t){this._clearTimerToHide(e),e.hideTimer=setTimeout(()=>this._timeToHideHandler(e),t)}static _clearTimerToHide(e){e.hideTimer&&(clearTimeout(e.hideTimer),e.hideTimer=null)}static _messageMisc(e,t,i){this.setText(e),document.body.appendChild(this),window.customElements.whenDefined("i-bubble").then(()=>(this.offsetWidth,this.setPopup(!0),new s.a(e=>requestAnimationFrame(e)))).then(()=>{i&&i(this)}),t>0&&y._setTimerToHide(this,t)}static message(e,t){const i=document.createElement("i-bubble");i.setType("message"),t=null!=t?t:this.duration,this._messageMisc.call(i,e,t)}static networkError(e,t){const i=document.createElement("i-bubble");i.setType("network-error"),t=null!=t?t:this.duration,this._messageMisc.call(i,e,t)}static success(e,t){const i=document.createElement("i-bubble");i.setType("success"),t=null!=t?t:this.duration,this._messageMisc.call(i,e,t)}static error(e,t){const i=document.createElement("i-bubble");i.setType("error"),t=null!=t?t:this.duration,this._messageMisc.call(i,e,t)}static popupLogin(e){const t=this.popup(i18n("reqeust_login_message"),{showButton:!0,btnValue:i18n("to_login"),type:"message",onBtnClick:null!=e?e:()=>{a.userStore.openModal()}}),i=Date.now();let o=this.duration2;t.onmouseenter=()=>{o=Date.now()-i,y._clearTimerToHide(t)},t.onmouseleave=()=>{y._setTimerToHide(t,o)}}static popupAddHomeAI(e){const t=this.popup(i18n("add_infinity_ai"),{showButton:!0,btnValue:i18n("add_now"),type:"message",onBtnClick:e,duration:8e3}),i=Date.now();let o=this.duration2;t.onmouseenter=()=>{o=Date.now()-i,y._clearTimerToHide(t)},t.onmouseleave=()=>{y._setTimerToHide(t,o)}}static popupLoading(e){const t=this.popup(i18n("wallpaper_loading"),{duration:0,showButton:!0,btnValue:i18n("cancel"),type:"loading",onBtnClick:e});return()=>setTimeout(()=>this._timeToHideHandler(t),y.waitForReady)}static loading(e){const t=this.popup(e,{type:"loading",duration:0});return()=>setTimeout(()=>this._timeToHideHandler(t),y.waitForReady)}static popup(e,t){const{duration:i=this.duration2,btnValue:o,onBtnClick:s,type:n,showButton:a}=t,r=document.createElement("i-bubble");return r.setType(n),o&&r.setBtnValue(o),a&&r.setShowButton(a),this._messageMisc.call(r,e,i,()=>{if(r.showButton){r.shadowRoot.querySelector(".i-bubble .i-bubble-button").onclick=e=>{s&&s(e),this._timeToHideHandler(r)}}}),r}firstUpdated(){const e="\n      background-size: cover;\n      background-repeat: no-repeat;\n      background-position: center;\n      display: block;\n    ",t=document.createElement("style");t.appendChild(document.createTextNode(`\n      .i-bubble .icon.icon-network-error{\n        background-image: url(${d});${e}\n      }\n      .i-bubble .icon.icon-success{\n        background-image: url(${b});${e}\n      }\n      .i-bubble .icon.icon-error{\n        background-image: url(${g});${e}\n      }\n      .i-bubble .icon.icon-loading{\n        background-image: url(${m});${e}\n      }\n      `)),this.shadowRoot.appendChild(t)}render(){return r.e`
      <section class="i-bubble ${this.type}${this.popup?" popup":""}">
        <section class="i-bubble-wrap">
          <i class="icon icon-${this.type}"></i>
          <span class="i-bubble-text">${this.text}</span>
          <input
            class="i-bubble-button"
            type="button"
            .value=${this.btnValue}
            style="${this.showButton?"":"display: none;"}"
          />
        </section>
      </section>
      <section class="i-bubble-mask" @click=${h.a.stopBubble}></section>
    `}setType(e){this.type=e}setText(e){this.text=e}setBtnValue(e){this.btnValue=e}setPopup(e){this.popup=e}setShowButton(e){this.showButton=e}}y.duration=3e3,y.duration2=5e3,y.waitForReady=1e3/60,y.styles=l,u([c.g],y.prototype,"type",void 0),u([c.g],y.prototype,"text",void 0),u([c.g],y.prototype,"btnValue",void 0),u([c.g],y.prototype,"popup",void 0),u([c.g],y.prototype,"showButton",void 0),u([c.b],y.prototype,"setType",null),u([c.b],y.prototype,"setText",null),u([c.b],y.prototype,"setBtnValue",null),u([c.b],y.prototype,"setPopup",null),u([c.b],y.prototype,"setShowButton",null),window.customElements.define("i-bubble",y);t.default=y},397:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return n}));class o{constructor(){this._caches={},this._setCaches=e=>(...t)=>{this._caches[e]=t}}}const s=[],n=e=>new Proxy(e,{set:(e,t,i)=>null===i?(e[t]=i,!0):"function"==typeof e[t]?(console.warn("失败：重复注册"),!0):(e[t]=i,s.includes(t)&&delete e._caches[t],e._caches.hasOwnProperty(t)&&(e[t](...e._caches[t]),delete e._caches[t]),!0),get:(e,t)=>"function"==typeof e[t]?e[t]:e._setCaches(t)})},398:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i(5),s=i.n(o),n=(i(7),i(0)),a=i(85);async function r(){if(n.s||n.r){if("granted"!==await new s.a(e=>{!function(){try{Notification.requestPermission().then()}catch(e){return!1}return!0}()?Notification.requestPermission(e):Notification.requestPermission().then(e)}))throw new Error}else await a.a.request(["notifications"])}},428:function(e,t,i){"use strict";i.r(t),i.d(t,"userStore",(function(){return v}));i(7),i(20);var o=i(5),s=i.n(o),n=i(2),a=i(307),r=i(23),c=i(0),l=i(106),h=i(24),p=i.n(h),u=i(162),d=i(161),g=i(430),b=i(429),m=i(13),y=i(50),f=i(333),w=function(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};class k extends a.a{constructor(){super(),this.isExpired=!1,this.isLogin=!1,this.token="",this.userInfo={},this.refreshToken="",this.mobileloginExpire=0,this.mobileloginUrl="",this.areaCodeList=[],this.thirdList=[{type:r.f.ThirdLoginType.wechat,title:i18n("wechat"),bindStatus:!1,nick_name:""},{type:r.f.ThirdLoginType.qq,title:"QQ",bindStatus:!1,nick_name:""},{type:r.f.ThirdLoginType.google,title:"Google",bindStatus:!1,nick_name:""},{type:r.f.ThirdLoginType.facebook,title:"Facebook",bindStatus:!1,abondon:!0,nick_name:""},{type:r.f.ThirdLoginType.weibo,title:i18n("xin_lang_weibo"),bindStatus:!1,abondon:!0,nick_name:""}],this.userProfilePromise=s.a.resolve(),this.wpColorUpdate=0,this.logining=!1,this.modalOpen=!1,this.removeAccountDisableSec=10,this.removeAccountDisableTimer=null,this.showLoginTipModal=!1,this.profileModal=!1,this.syncListModal=!1,this.isModify=!1,this.openMiniWindow=e=>{const t=Math.floor(window.screenY+200),i=Math.floor(window.screenX+window.innerWidth/3);return window.open(e,"_blank",`top=${t},left=${i},height=600,width=770,menubar=no,toolbar=yes,location=yes,status=no,resizable=no`)},this.binding=!1,this.bindListener=e=>{let t;const i=()=>{t=setTimeout(()=>{e.postMessage({from:"origin_login"},"*"),e.closed?(window.removeEventListener("message",o),this.binding=!1):i()},500)};i();const o=async e=>{try{if(!e.data||!e.data.key||"bind"!==e.data.key)return;clearTimeout(t),window.removeEventListener("message",o,!1);const{message:i}=e.data;let s;switch(i.type){case r.f.ThirdLoginType.weibo:case r.f.ThirdLoginType.google:case r.f.ThirdLoginType.facebook:case r.f.ThirdLoginType.wechat:case r.f.ThirdLoginType.qq:s=await r.f.bindThird(i.type,i.code)}if(s.error)return void l.message.error(s.error.message);this.bindSuccess("third",s.data),l.message.success(i18n("bind_success"))}catch(e){l.message.error(i18n("network_error"))}finally{this.binding=!1}};window.addEventListener("message",o,!1)},this.countdownTimer=null,this.checkMobileUrlTimer=null,this.isShowLogoutConfirm=!1,this.showConfirmOpt="",this.isShowSecondProfileModal=!1,this.secondProfileModalType=null,this.clearAllData=!1,this.loading=!1,this.URL=c.x}get thirdAccountList(){const e={};return this.userInfo.third_account&&this.userInfo.third_account.forEach(t=>{e[t.platform]=t}),this.thirdList.map(t=>e[t.type]?Object.assign(Object.assign({},t),{bindStatus:!0,nick_name:e[t.type].nick_name}):t)}setWpColorUpdate(e){this.wpColorUpdate=e}closeModal(){this.modalOpen=!1}openModal(){this.modalOpen=!0}toggleLoginTipModal(){this.showLoginTipModal=!this.showLoginTipModal}closeLoginTipModal(){this.showLoginTipModal=!1}closeProfileModal(){this.profileModal=!1}openProfileModal(){this.profileModal=!0,this.openModify()}closeSyncListModal(){this.syncListModal=!1}openSyncListModal(){this.syncListModal=!0}openModify(){this.isModify=!0}async modifyProfile(e){try{const t=await r.f.updateProfile(e);Object(n.i)(()=>{if(t&&0===t.code){const{user:{name:e,gender:i,avatar:o}}=t.data;this.userInfo.name=e,this.userInfo.gender=i,this.userInfo.avatar=o}else l.message.error(i18n("update_data_failure"))})}catch(e){l.message.error(e.message)}}async getUserProfile(){const e=await r.f.getUserProfile();Object(n.i)(()=>{if(e)if(0===e.code&&this.isLogin){const{gender:t,name:i,avatar:o}=e.data;this.userInfo.name=i,this.userInfo.gender=t,this.userInfo.avatar=o,this.userInfo["auto-backup"]=e.data["auto-backup"],this.userInfo["wp-color-update"]=e.data["wp-color-update"],this.userInfo["backup-version-v2"]=e.data["backup-version-v2"],this.userInfo.email=e.data.email,this.userInfo.phone_number=e.data.phone_number,this.userInfo.third_account=e.data.third_account}else 3012===e.code&&(l.message.error(e.message),this.exitAccount())})}async getAreaCodeList(){const{data:e,error:t}=await r.f.getAreaCodeList();t||(null==e?void 0:e.length)&&Object(n.i)(()=>{this.areaCodeList=e})}async updateAvatar(e){try{return await r.f.uploadAvatar(e)}catch(e){l.message.error(i18n("upload_avatar_failure"))}}closeModify(){this.isModify=!1}thirdPartyLogin(e){let t;switch(this.logining=!0,e){case"facebook":t=this.URL+"/login/facebook";break;case"google":t=this.URL+"/login/google";break;case"qq":t=this.URL+"/login/qq";break;case"sina":t=this.URL+"/login/weibo";break;case"wechat":t=this.URL+"/login/wechat"}setTimeout(async()=>{const e=this.openMiniWindow(t);if(this.opener=e,c.n)return;const i=setInterval(()=>{e.postMessage({from:"origin_login"},"*")},300),o=e=>{if(!e.data||!e.data.key||"login"!==e.data.key)return;clearInterval(i),window.removeEventListener("message",o,!1);const{message:t}=e.data;this.login3rdSuccess(t)};window.addEventListener("message",o,!1)},300)}get isLastId(){const e=this.userInfo||{},t=e.third_account||[];let i=0;return e.email&&++i,e.phone_number&&++i,i+=t.length,i<=1}thirdPartyBind(e){if(this.binding)return;let t;switch(this.binding=!0,e){case r.f.ThirdLoginType.weibo:case r.f.ThirdLoginType.google:case r.f.ThirdLoginType.facebook:case r.f.ThirdLoginType.wechat:case r.f.ThirdLoginType.qq:t=this.openMiniWindow(`${c.x}/bind/to?type=${e}`),this.bindListener(t)}}async thirdPartyUnbind(e){let t;switch(e){case r.f.ThirdLoginType.weibo:case r.f.ThirdLoginType.google:case r.f.ThirdLoginType.facebook:case r.f.ThirdLoginType.qq:case r.f.ThirdLoginType.wechat:t=await r.f.unbindThird(e)}return t}bindSuccess(e,t){if("email"===e)this.userInfo.email=t;else if("phone"===e)this.userInfo.phone_number=t;else if("third"===e){const e=this.userInfo.third_account||[];e.push(t),this.userInfo.third_account=e}}unbindSuccess(e,t){if("email"===e)this.userInfo.email=null;else if("phone"===e)this.userInfo.phone_number=null;else if("third"===e){const e=this.userInfo.third_account||[],i=e.findIndex(e=>e.platform===t);if(-1===i)return;e.splice(i,1),this.userInfo.third_account=e}}async login(e){const t={};if(t.password=e.password,"email"===e.type)t.email=e.account;else{if("phone"!==e.type)return;t.phone_number=e.account}const i=await r.f.login(t);Object(n.i)(()=>{if(!i||0!==i.code)throw l.message.error(i.message),new Error(i.code);this.loginEmailSuccess(i.data.user),this.setToken(i.data),this.setRefreshToken(i.data.refreshToken)})}async getMobileloginUrl(e=!1){if(e&&(this.mobileloginUrl="",this.mobileloginExpire=0),u.f){const{data:e,error:t}=await r.f.getMobileloginUrl();if(t)return void Object(n.i)(()=>{this.mobileloginExpire=0});Object(n.i)(()=>{this.mobileloginUrl=e.url,this.mobileloginExpire=Math.floor(e.expire/1e3)}),this.checkMobileloginUrl(e.code,e.type),0!==this.mobileloginExpire&&(this.countdownTimer=setInterval(()=>{Object(n.i)(()=>{this.mobileloginExpire-=1}),this.mobileloginExpire<=0&&clearInterval(this.countdownTimer)},1e3))}}async checkMobileloginUrl(e,t,i=5e3){u.f&&this.mobileloginExpire>3&&(clearTimeout(this.checkMobileUrlTimer),this.checkMobileUrlTimer=setTimeout(async()=>{const{data:o}=await r.f.checkMobileloginUrl(e,t);if(o&&o.expired)return clearInterval(this.countdownTimer),void Object(n.i)(()=>{this.mobileloginExpire=0});this.checkMobileloginUrl(e,t,i)},i))}async loginEmailSuccess(e){this.logining=!1,this.closeModal(),this.isLogin=!0,this.userInfo=e,this.isExpired=!1,this.settingLoginSuccess()}setUserData(e){this.logining=!1,this.closeModal(),this.isLogin=e.isLogin,this.userInfo=e,this.isExpired=!1;["token","refreshToken","isLogin"].forEach(e=>delete this.userInfo[e])}async login3rdSuccess(e){if(!e||!Object.keys(e).length)return void this.cancelLogin();const t=e["login-type"];if(["qq","wechat"].includes(t)){const t=await r.f.loginWithUid(e);0===t.code?Object(n.i)(()=>{this.setUserData(e),this.setToken(t.data),this.setRefreshToken(t.data.refreshToken)}):3006===t.code&&l.message.error("获取token失败")}else this.setUserData(e),this.setToken(e),this.setRefreshToken(e.refreshToken);this.settingLoginSuccess()}settingLoginSuccess(){b.b.changeSetting("view","isHideIcp",!0)}cancelLogin(){var e;this.logining=!1,null===(e=this.opener)||void 0===e||e.close()}toggleClear(e){this.clearAllData=e}logout(e){this.isShowLogoutConfirm=!0,this.showConfirmOpt=e,"remove"===e&&(this.removeAccountDisableSec=10,clearInterval(this.removeAccountDisableTimer),this.removeAccountDisableTimer=setInterval(()=>{Object(n.i)(()=>{this.removeAccountDisableSec-=1,0===this.removeAccountDisableSec&&(clearInterval(this.removeAccountDisableTimer),this.removeAccountDisableTimer=null)})},1e3))}showSecondProfileModal(e){this.isShowSecondProfileModal=!0,this.secondProfileModalType=e}closeSecondProfileModal(){this.isShowSecondProfileModal=!1,this.secondProfileModalType=null}async exitAccount(){this.loading=!0,f.b.postIframeMessage({type:f.a.logout,logoutWithClear:this.clearAllData}),await new s.a(e=>{setTimeout(()=>{this.clearAllData?this.clearAllStore().then(e):e(null)},200)}),Object(n.i)(()=>{this.isLogin=!1,this.userInfo={},this.clearToken()}),this.clearAllData?window.location.reload():(Object(n.i)(()=>this.loading=!1),this.closeLogoutConfirm(),this.closeProfileModal(),c.s&&g.pluginStore.hideLast())}async deleteAccount(){this.loading=!0;const e=await r.f.deleteAccount();Object(n.i)(()=>{e&&0===e.code?this.exitAccount():(3012===e.code&&this.exitAccount(),l.message.error(e.message)),this.loading=!1})}restoreKeysToStorage(e){e.forEach(({data:e,key:t})=>localStorage.setItem(t,e))}async clearAllStore(){this.stopAutoBackupReaction(),this.stopToStorageReaction(),await m.a.deleteAllForLogout();const e=[y.c,y.d];await this._deleteIdb(e),d.slave.sendMessage("tabs-reload")}async _deleteIdb(e){const t=await new s.a(e=>p.a.keys((t,i)=>e(i)));await s.a.all(e.map(e=>new s.a(i=>{const o=e.split("->");if(1===o.length)return t.includes(e)?void p.a.removeItem(e,i):void i(null);i(null),t.includes(o[0])&&p.a.getItem(o[0],e=>{o.reduce((e,t,i)=>(i===o.length-1&&Reflect.deleteProperty(e,t),e[t]),e),p.a.setItem(o[0],i)})})))}_clearLocalStorage(e){const t=new Map;e.filter(Boolean).forEach(e=>{const i=e.split("->");if(1===i.length)return void t.set(e,localStorage.getItem(e));const o=JSON.parse(localStorage.getItem(i[0]));i.slice(1).forEach((e,t)=>{const s=0===t?o:o[i[t]];for(const t in s)e!==t&&Reflect.deleteProperty(s,t)}),t.set(i[0],JSON.stringify(o))}),localStorage.clear();for(const e of t.keys())localStorage.setItem(e,t.get(e))}closeLogoutConfirm(){this.isShowLogoutConfirm=!1}setToken(e){this.token=e.token,f.b.postIframeMessage({type:f.a.authToken,authToken:v.token})}setRefreshToken(e){this.refreshToken=e}clearToken(){this.token="",this.refreshToken=""}setOutdated(){this.isExpired=!0,this.isLogin=!1}toggleReLogin(){this.isExpired=!1}getPhoneNumber(){if(this.userInfo.phone_number){const e=this.userInfo.phone_number+"";return`${e.slice(0,3)}****${e.slice(-4)}`}return""}}w([n.g],k.prototype,"isExpired",void 0),w([n.g],k.prototype,"isLogin",void 0),w([n.g],k.prototype,"token",void 0),w([n.g],k.prototype,"userInfo",void 0),w([n.g],k.prototype,"refreshToken",void 0),w([n.g],k.prototype,"mobileloginExpire",void 0),w([n.g],k.prototype,"mobileloginUrl",void 0),w([n.g],k.prototype,"areaCodeList",void 0),w([n.e],k.prototype,"thirdAccountList",null),w([n.g],k.prototype,"wpColorUpdate",void 0),w([n.b],k.prototype,"setWpColorUpdate",null),w([n.g],k.prototype,"opener",void 0),w([n.g],k.prototype,"logining",void 0),w([n.g],k.prototype,"modalOpen",void 0),w([n.g],k.prototype,"removeAccountDisableSec",void 0),w([n.g],k.prototype,"removeAccountDisableTimer",void 0),w([n.b],k.prototype,"closeModal",null),w([n.b],k.prototype,"openModal",null),w([n.g],k.prototype,"showLoginTipModal",void 0),w([n.b],k.prototype,"toggleLoginTipModal",null),w([n.b],k.prototype,"closeLoginTipModal",null),w([n.g],k.prototype,"profileModal",void 0),w([n.g],k.prototype,"syncListModal",void 0),w([n.b],k.prototype,"closeProfileModal",null),w([n.b],k.prototype,"openProfileModal",null),w([n.b],k.prototype,"closeSyncListModal",null),w([n.b],k.prototype,"openSyncListModal",null),w([n.g],k.prototype,"isModify",void 0),w([n.b],k.prototype,"openModify",null),w([n.b],k.prototype,"modifyProfile",null),w([n.b],k.prototype,"getUserProfile",null),w([n.b],k.prototype,"getAreaCodeList",null),w([n.b],k.prototype,"updateAvatar",null),w([n.b],k.prototype,"closeModify",null),w([n.b],k.prototype,"thirdPartyLogin",null),w([n.g],k.prototype,"binding",void 0),w([n.e],k.prototype,"isLastId",null),w([n.b],k.prototype,"thirdPartyBind",null),w([n.b],k.prototype,"thirdPartyUnbind",null),w([n.b],k.prototype,"bindSuccess",null),w([n.b],k.prototype,"unbindSuccess",null),w([n.b],k.prototype,"login",null),w([n.b],k.prototype,"getMobileloginUrl",null),w([n.b],k.prototype,"checkMobileloginUrl",null),w([n.b],k.prototype,"loginEmailSuccess",null),w([n.b],k.prototype,"setUserData",null),w([n.b],k.prototype,"login3rdSuccess",null),w([n.b],k.prototype,"cancelLogin",null),w([n.g],k.prototype,"isShowLogoutConfirm",void 0),w([n.g],k.prototype,"showConfirmOpt",void 0),w([n.g],k.prototype,"isShowSecondProfileModal",void 0),w([n.g],k.prototype,"secondProfileModalType",void 0),w([n.g],k.prototype,"clearAllData",void 0),w([n.b],k.prototype,"toggleClear",null),w([n.b],k.prototype,"logout",null),w([n.b],k.prototype,"showSecondProfileModal",null),w([n.b],k.prototype,"closeSecondProfileModal",null),w([n.g],k.prototype,"loading",void 0),w([n.b],k.prototype,"exitAccount",null),w([n.b],k.prototype,"deleteAccount",null),w([n.b],k.prototype,"clearAllStore",null),w([n.b],k.prototype,"closeLogoutConfirm",null),w([n.b],k.prototype,"setToken",null),w([n.b],k.prototype,"setRefreshToken",null),w([n.b],k.prototype,"clearToken",null),w([n.b],k.prototype,"setOutdated",null),w([n.b],k.prototype,"toggleReLogin",null);const v=new k;Object(n.c)(()=>{v.firstSync&&(v.isLogin?(v.closeModal(),v.toggleReLogin(),v.userProfilePromise=v.getUserProfile()):(v.closeProfileModal(),v.closeSecondProfileModal()))}),v.initSyncStore(m.l,["userInfo","isLogin","token","refreshToken","wpColorUpdate"]),m.j.injectUserStore(v),m.j.injectSendTabsSync(e=>{d.slave.sendMessage("tabs-sync",e)})},429:function(e,t,i){"use strict";i.d(t,"b",(function(){return m})),i.d(t,"a",(function(){return f}));i(20),i(7);var o=i(2),s=i(307),n=i(15),a=i(85),r=i(151),c=i(311),l=i(0),h=i(382),p=i(398),u=i(309),d=i(13),g=function(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};class b extends s.a{constructor(){super(...arguments),this.localSettings={},this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.iconSpaceWidth=0,this.iconSpaceHeight=0,this.setting=this.init(),this.updatetime=0,this.permission={topUseful:-1,topBookmark:-1,searchSuggest:-1,gmailNotice:-1,gmailCount:-1,todoNotice:-1},this.logs=new Map,this.permissionMapper={topBookmark:[["bookmarks","favicon"],[]],topUseful:[["topSites","favicon"],[]],searchSuggest:[[],["https://suggestion.baidu.com/","https://google.com/"]],gmailNotice:[["notifications"],["https://mail.google.com/"]],gmailCount:[[],["https://mail.google.com/"]],todoNotice:[["notifications"],[]]},this.showSettingHomeModal=!1,this.webClickName=""}init(e={}){return{notice:Object.assign({},r.b.notice),link:Object.assign({},r.b.link),view:Object.assign({},r.b.view),layout:Object.assign({},r.b.layout),animation:Object.assign({},r.b.animation),icon:Object.assign({},r.b.icon),search:Object.assign({},r.b.search),font:Object.assign({},r.b.font),_v1Setting:e}}get withPermissionTopUseful(){return this.setting.view.topUseful&&1===this.permission.topUseful}get withPermissionTopBookmark(){return this.setting.view.topBookmark&&1===this.permission.topBookmark}get withPermissionSearchSuggest(){return this.setting.search.searchSuggest&&1===this.permission.searchSuggest}get needPermissionList(){const e=[],{view:t,notice:i,search:o}=this.setting,{topUseful:s,topBookmark:n,searchSuggest:a,gmailNotice:r,gmailCount:c,todoNotice:p}=this.permission;return l.m&&o.searchSuggest&&1!==a&&e.push({key:"searchSuggest",title:i18n("permission_serch_suggest_title"),content:i18n("permission_serch_suggest_content")}),l.m&&i.gmail&&1!==r&&e.push({key:"gmailNotice",title:i18n("permission_gmail_notice_title"),content:i18n("permission_gmail_notice_content")}),l.m&&i.gmailNumber&&1!==c&&e.push({key:"gmailCount",title:i18n("permission_gmail_num_title"),content:i18n("permission_gmail_num_content")}),l.s||l.r||!t.topBookmark||1===n||e.push({key:"topBookmark",title:i18n("permission_top_bookmark_title"),content:i18n("permission_top_bookmark_content")}),l.s||l.r||!t.topUseful||1===s||e.push({key:"topUseful",title:i18n("permission_top_useful_title"),content:i18n("permission_top_useful_content")}),h.a.needNotificationPermission&&1!==p&&((l.s||l.r)&&"denied"===Notification.permission||e.push({key:"todoNotice",title:i18n("permission_todo_notice_title"),content:i18n("permission_todo_notice_content")})),e}get sideRatio(){return this.setting.view.scaleSide}reset(){this.setting=this.init(this.setting._v1Setting),this.changeLayoutCb(this.setting.layout.col,this.setting.layout.row)}diffRemote(e){return!o.d.structural(e.setting||{},this.setting)}sendSettingValue(){Object.keys(this.localSettings).length&&(u.a.sendEvent({settingValue:this.localSettings}),this.localSettings={})}async mergeRemote(e){const t=e.setting;if(!e.setting)return;const i=this.setting;this.setting={notice:Object.assign(Object.assign({},i.notice),t.notice),link:Object.assign(Object.assign({},i.link),t.link),view:Object.assign(Object.assign({},i.view),t.view),layout:Object.assign(Object.assign({},i.layout),t.layout),animation:Object.assign(Object.assign({},i.animation),t.animation),icon:Object.assign(Object.assign({},i.icon),t.icon),search:Object.assign(Object.assign({},i.search),t.search),font:Object.assign(Object.assign({},i.font),t.font),_v1Setting:t._v1Setting};const s=await n.a.getTimestamp();Object(o.i)(()=>{this.updatetime=s})}sendSettingLog(e,t){this.logs.has(e)&&clearTimeout(this.logs.get(e)),this.logs.set(e,setTimeout(()=>{u.a.sendEvent({settingAction:{[e]:t}}),this.logs.delete(e)},2e3))}async changeSetting(e,t,i){if(this.setting[e][t]===i)return;this.setting[e][t]=i,"layout"===e&&("custom"===t&&!0===i||"customItem"===t)&&(this.setting.layout.row=this.setting.layout.customItem[0],this.setting.layout.col=this.setting.layout.customItem[1],this.changeLayoutCb(this.setting.layout.col,this.setting.layout.row));let s=`${e}_${t}`,a=i;"layout"!==e||"col"!==t&&"row"!==t||(this.changeLayoutCb(this.setting.layout.col,this.setting.layout.row),s="layout",a=this.setting.layout.row+"*"+this.setting.layout.col),this.sendSettingLog(s,a),this.localSettings[s]=a;const r=await n.a.getTimestamp();Object(o.i)(()=>{this.updatetime=r}),this.changeSettingEffect(e,t,i)}changeLayoutCb(e,t){console.log("col, row",e,t),console.log("changeLayoutCb 未注册")}changeLayout(e){this.changeLayoutCb=e}changeSettingEffect(e,t,i){switch(!0){case"topBookmark"===t:i&&this.requestPermission("topBookmark",!0);break;case"topUseful"===t:i&&this.requestPermission("topUseful",!0);break;case"notice"===e&&"gmail"===t:i&&this.requestPermission("gmailNotice",!0);break;case"notice"===e&&"gmailNumber"===t:i&&this.requestPermission("gmailCount",!0);break;case"searchSuggest"===t:i&&this.requestPermission("searchSuggest",!0)}}async checkPermission(e){if(l.s||l.r){switch(e){case"todoNotice":case"gmailNotice":return void("granted"===Notification.permission?this.permission[e]=1:"default"===Notification.permission?this.permission[e]=-1:this.permission[e]=0)}if(l.s)return}if(1===this.permission[e]){const t=this.permissionMapper[e];try{if(await a.a.has(t[0],t[1]))return}catch(e){console.log(e)}Object(o.i)(()=>{this.permission[e]=-1})}const t=this.permissionMapper[e];try{await a.a.has(t[0],t[1])&&Object(o.i)(()=>{this.permission[e]=1})}catch(e){}}async requestPermission(e,t=!1){if((l.s||l.r)&&["todoNotice","gmailNotice"].includes(e))return await Object(p.a)(),void Object(o.i)(()=>{this.permission.todoNotice=1,this.permission.gmailNotice=1});const i=this.permissionMapper[e];if(t||0!==this.permission[e]&&1!==this.permission[e])try{await a.a.request(i[0],i[1]),Object(o.i)(()=>{this.permission[e]=1}),"gmailNotice"===e&&this.checkPermission("todoNotice")}catch(t){t&&"REJECT"===t.message&&Object(o.i)(()=>{this.permission[e]=0})}}async requestAllPermission(){if(l.s||l.r)return await Object(p.a)(),void Object(o.i)(()=>{this.permission.todoNotice=1,this.permission.gmailNotice=1});const e=[[],[]];this.needPermissionList.forEach(t=>{const i=this.permissionMapper[t.key];e[0].push(...i[0]),i&&e[1].push(...i[1])});try{await a.a.request(e[0],e[1]),Object(o.i)(()=>{this.needPermissionList.forEach(e=>{this.permission[e.key]=1})})}catch(e){Object(o.i)(()=>{this.needPermissionList.forEach(e=>{this.permission[e.key]=0})})}}resetPermission(e){this.permission[e]=-1}setIconSpace(e){this.setting.icon.scale=e.iconScale,this.setting.layout.colGap=e.colGap,this.setting.layout.rowGap=e.rowGap,this.setting.search.scale=e.searchScale}openSearchSuggest(){this.setting.search.searchSuggest?this.requestPermission("searchSuggest",!0):this.setting.search.searchSuggest=!0}get sideScaleRatio(){return this.setting.view.scaleSide}toggleShowSettingHome(e){this.setting.view.isShowHomepageBtn=!e}toggleSettingHomeModal(){this.webClickName="",this.showSettingHomeModal=!this.showSettingHomeModal}closeSettingHomeModal(){this.showSettingHomeModal=!1}setWebClickName(e){this.webClickName=e}}g([o.g],b.prototype,"innerWidth",void 0),g([o.g],b.prototype,"innerHeight",void 0),g([o.g],b.prototype,"iconSpaceWidth",void 0),g([o.g],b.prototype,"iconSpaceHeight",void 0),g([o.g],b.prototype,"setting",void 0),g([o.g],b.prototype,"updatetime",void 0),g([o.g],b.prototype,"permission",void 0),g([o.e],b.prototype,"withPermissionTopUseful",null),g([o.e],b.prototype,"withPermissionTopBookmark",null),g([o.e],b.prototype,"withPermissionSearchSuggest",null),g([o.e],b.prototype,"needPermissionList",null),g([o.e],b.prototype,"sideRatio",null),g([o.b],b.prototype,"reset",null),g([o.b],b.prototype,"mergeRemote",null),g([o.b],b.prototype,"changeSetting",null),g([o.b],b.prototype,"checkPermission",null),g([o.b],b.prototype,"requestPermission",null),g([o.b],b.prototype,"requestAllPermission",null),g([o.b],b.prototype,"resetPermission",null),g([o.b],b.prototype,"setIconSpace",null),g([o.b],b.prototype,"openSearchSuggest",null),g([o.e],b.prototype,"sideScaleRatio",null),g([o.b],b.prototype,"toggleShowSettingHome",null),g([o.g],b.prototype,"showSettingHomeModal",void 0),g([o.b],b.prototype,"toggleSettingHomeModal",null),g([o.b],b.prototype,"closeSettingHomeModal",null),g([o.g],b.prototype,"webClickName",void 0),g([o.b],b.prototype,"setWebClickName",null);const m=new b;m.initSyncStore(d.h,["setting","permission","updatetime"],r.b),m.initAutoBackup("setting",["setting"]),Object(o.c)(()=>{m.firstSync&&m.setting.view.topBookmark&&m.checkPermission("topBookmark")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.view.topUseful&&m.checkPermission("topUseful")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.notice.gmail&&m.checkPermission("gmailNotice")},{delay:50}),Object(o.c)(()=>{h.a.firstSync&&h.a.needNotificationPermission&&m.checkPermission("todoNotice")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.notice.gmailNumber&&m.checkPermission("gmailCount")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.search.searchSuggest&&m.checkPermission("searchSuggest")},{delay:50}),Object(o.c)(()=>{m.firstSync&&1===m.permission.gmailNotice&&n.a.send({key:"bg-notice-gmail-permission",data:!0})}),Object(o.c)(()=>{if(m.firstSync){const{gmail:e,gmailVoice:t,gmailNumber:i}=m.setting.notice,{gmailCount:o,gmailNotice:s}=m.permission;n.a.send({key:"bg-notice-gmail-updated",data:{gmail:e&&1===s,gmailVoice:t,gmailNumber:i&&(1===s||1===o)}})}},{delay:100}),Object(o.c)(()=>{if(m.firstSync){const e={"--side-ratio":m.sideRatio,"--main-ratio":m.setting.view.scaleMain,"--icon-radius":Math.round(100*m.setting.icon.radius)+"%","--icon-font-color":m.setting.font.color,"--icon-font-size":Math.ceil(Math.max(m.setting.font.size*m.setting.view.scaleMain,12))+"px","--icon-opacity":m.setting.icon.opacity,"--icon-visible":m.setting.icon.isHideIconName?"hidden":"visible","--search-radius":""+m.setting.search.radius,"--search-opacity":m.setting.search.opacity};n.a.setStyle(e)}},{delay:50}),Object(o.c)(()=>{if(m.firstSync){let e=0,t=20;m.withPermissionTopBookmark&&(e+=36),m.withPermissionTopUseful&&(t+=26);const i={"--top-bar-height":e+"px","--settings-icon-top-offset":t+"px"};n.a.setStyle(i)}});const y=e=>{const t={"--search-height":e.searchHeight,"--search-width":e.searchWidth,"--search-margin-top":e.searchMarginTop,"--search-margin-bottom":e.searchMarginBottom,"--search-ratio":e.searchRatio,"--icon-box-width":e.iconBoxWidth,"--icon-box-height":e.iconBoxHeight,"--icon-one-height":e.iconOneHeight,"--icon-width":e.iconWidth,"--mini-icon-padding":e.miniIconPadding,"--icon-ratio":e.iconRatio,"--icon-row":m.setting.layout.row,"--icon-col":m.setting.layout.col,"--main-icons-margin":e.iconsMargin};n.a.setStyle(t)},f=(e=!0)=>{const t={row:m.setting.layout.row,col:m.setting.layout.col,rowGap:m.setting.layout.rowGap,colGap:m.setting.layout.colGap,iconScale:m.setting.icon.scale,searchScale:m.setting.search.scale,innerHeight:innerHeight,innerWidth:innerWidth,miniMode:m.setting.icon.miniMode,fontSize:m.setting.font.size,topUseful:m.withPermissionTopUseful,topBookmark:m.withPermissionTopBookmark,mainRatio:m.setting.view.scaleMain};if(e)requestIdleCallback(()=>{const e=Object(c.a)(t);y(e)});else{const e=Object(c.a)(t);y(e)}};Object(o.c)(()=>{m.firstSync&&f(!1)},{delay:40}),window.addEventListener("resize",n.a.throttle(()=>{f(!1)},56))},430:function(e,t,i){"use strict";i.r(t),i.d(t,"pluginStore",(function(){return h}));i(7);var o=i(2),s=i(85),n=i(397);class a extends n.a{opened(e){}}const r=Object(n.b)(new a);var c=function(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};class l{constructor(){this.pluginsMap={"infinity://weather":"side-weather","infinity://todos":"side-todos","infinity://notes":"side-notes","infinity://history":"side-history","infinity://bookmarks":"side-bookmarks","infinity://extension":"side-extension","infinity://chrome-apps":"chrome-apps","infinity://wallpaper":"wallpaper","infinity://settings":"side-profile",search:"side-search",profile:"side-profile",editIcon:"side-editicon","side-tutorial":"side-tutorial","infinity://chatai":"chatai"},this.pluginsTags={"side-weather":!1,"side-todos":!1,"side-notes":!1,"side-history":!1,"side-bookmarks":!1,"side-extension":!1,"chrome-apps":!1,"side-profile":!1,"side-search":!1,"side-editicon":!1,"side-tutorial":!1,wallpaper:!1,chatai:!1},this.pluginViews=[],this.focusRepair=!1,Object(o.h)(()=>this.pluginViews.map(e=>e),([e])=>{r.opened(e)})}initDom(e){this.pluginsTags[e]=!0}async show(e){if(this.pluginViews.includes(e))return;const t=this.pluginsMap[e];if(!1===this.pluginsTags[t])try{await this.requestPermission(t),Object(o.i)(()=>{this.pluginsTags[t]=!0,this.pluginViews.push(e)})}catch(e){console.log("show:",e)}else this.pluginViews.push(e)}async showRepair(){this.focusRepair=!0,this.show("profile")}async showRepairBadVersion(){this.focusRepair=!0,this.show("profile")}blurRepair(){this.focusRepair=!1}requestPermission(e){switch(e){case"side-bookmarks":return s.a.request(["bookmarks","favicon"]);case"side-extension":case"chrome-apps":return s.a.request(["management"]);case"side-history":return s.a.request(["history","favicon"])}}hideLast(){const e=this.pluginViews.pop();return 0===this.pluginViews.length&&document.getElementsByTagName("newtab-main")[0].shadowRoot.querySelector(".swiper-content").style.setProperty("transform","none"),e}}c([o.g],l.prototype,"pluginsTags",void 0),c([o.b],l.prototype,"initDom",null),c([o.g],l.prototype,"pluginViews",void 0),c([o.g],l.prototype,"focusRepair",void 0),c([o.b],l.prototype,"show",null),c([o.b],l.prototype,"showRepair",null),c([o.b],l.prototype,"showRepairBadVersion",null),c([o.b],l.prototype,"blurRepair",null),c([o.b],l.prototype,"hideLast",null);const h=new l},432:function(e,t,i){e.exports=i.p+"images/error.f782e7c.png"},433:function(e,t,i){e.exports=i.p+"images/remind.896ff6f.png"}}]);